/*!
 * 
 * (C) Copyright IBM Corp. 2017 - 2020. All Rights Reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 * 
 * watson-web-channel 2.3.0
 * Contributors: Ethan Winters, Raymond Chu, Karen Harris, Ashley Lord, Amy Zhong, Ryan Simpson, Anthony Wong, Wilson Wong, David G Terry, Simon Burns, Damon Lundin, John Engstrom, Neil Mallinar
 * Built: Aug 10 2020 9:19 pm +00:00
 * 
 * 
 */
(window.webpackJsonpWatsonAssistantChat=window.webpackJsonpWatsonAssistantChat||[]).push([[66],{673:function(e,t,n){"use strict";n.r(t);var a=n(475),r=n(553),o=n(0),s=n.n(o),i=n(470),c=n.n(i),l=n(465),u=n(35),p=n.n(u),d=n(63),m=n.n(d),g=n(10),f=n.n(g),h=n(11),_=n.n(h),C=n(3),v=n.n(C),E=n(36),A=n.n(E),y=n(37),b=n.n(y),W=(n(569),n(59)),N=n.n(W),w=n(463),P=n(461),O=n(13),R=n(24),S=n(14),T=n(72),k=n.n(T),M=n(79);function I(e,t){var n=e[0],a=e[1],r=t[0],o=t[1];if(n===r&&a===o)return!0;if(n.length!==r.length)return!1;for(var s=0;s<=n.length;s++){var i=n[s],c=r[s];if(i!==c)return!1;if(a[i]!==o[c])return!1}return!0}var B,D=n(4),L=n(17),x=n(610),H=n(8),F=n(606),j=(B=function(e,t){return(B=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}B(e,t),e.prototype=null===t?A()(t):(n.prototype=t.prototype,new n)}),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.onAgentAvatarError=function(){t.setState({hasError:!0})},t}return j(t,e),t.prototype.render=function(){var e,t,n,a,r,o=this.state.hasError,i=this.props,c=i.agentProfile,l=i.languagePack,u=i.width,p=i.height,d=(null===(e=c)||void 0===e?void 0:e.nickname)||(null===(t=c)||void 0===t?void 0:t.full_name),m=null===(n=c)||void 0===n?void 0:n.profile_picture_url,g={width:u,height:p};return r=!o&&m?s.a.createElement("img",{src:m,alt:l.agent_ariaAgentAvatar,onError:this.onAgentAvatarError}):(null===(a=d)||void 0===a?void 0:a.match(/^[\x20-\xFE]+$/))?s.a.createElement("div",{"aria-label":l.agent_ariaAgentAvatar,className:"WAC__agentAvatar--circle",style:g},s.a.createElement("div",{className:"WAC__agentAvatar--letter"},d.charAt(0))):s.a.createElement(F.a,{width:u?Number(u.replace("px","")):void 0,height:p?Number(p.replace("px","")):void 0,"aria-label":l.agent_ariaAgentAvatar}),s.a.createElement("div",{className:"WAC__agentAvatar"},r)},t}(o.PureComponent),U=s.a.createContext(null),q=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={attachedToHost:null},t.modalElement=document.createElement("div"),t}return q(t,e),t.prototype.componentDidMount=function(){this.attachIfNeeded()},t.prototype.componentDidUpdate=function(){this.attachIfNeeded()},t.prototype.componentWillUnmount=function(){this.state.attachedToHost&&this.state.attachedToHost.removeChild(this.modalElement)},t.prototype.attachIfNeeded=function(){var e=this.context;e&&!this.state.attachedToHost&&(this.setState({attachedToHost:e}),e.appendChild(this.modalElement))},t.prototype.render=function(){return this.state.attachedToHost?c.a.createPortal(this.props.children,this.modalElement):null},t.contextType=U,t}(o.Component),G=n(96),z=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={renderTooltip:!1,allowAutoShow:t.props.withHumanAgent},t}return z(t,e),t.prototype.componentDidMount=function(){this.doUpdate(!1)},t.prototype.componentDidUpdate=function(e){this.doUpdate(e.mouseOverTarget)},t.prototype.doUpdate=function(e){var t=this,n=!1,a=!1;if(G.c)n=!1;else if(this.props.agentState.isPanelOpen!==this.props.withHumanAgent)n=!1;else if(this.props.mouseOverTarget&&!this.state.renderTooltip)n=!0;else if(e&&!this.props.mouseOverTarget)n=!1;else{if(this.state.renderTooltip||!this.state.allowAutoShow)return;n=!0,a=!0}n&&!this.state.renderTooltip?(this.setState({renderTooltip:!0,allowAutoShow:!1}),a&&p()((function(){t.setState({renderTooltip:!1})}),5e3)):!n&&this.state.renderTooltip&&this.setState({renderTooltip:!1})},t.prototype.render=function(){var e,t=this.props,n=t.botName,a=t.intl;e=t.withHumanAgent?"agent_ariaToggleViewAgent":"agent_ariaToggleViewBot";var r=a.formatMessage({id:e},{botName:n});return this.state.renderTooltip&&s.a.createElement(Q,null,s.a.createElement("div",{className:"WACModal__backToBotTooltip"},s.a.createElement("div",{className:"WACModal__backToBotTooltipSizer"},s.a.createElement("div",{className:"WACModal__backToBotTooltipPadding"}),s.a.createElement("div",{className:"WACModal__backToBotTooltipBubbleContainer"},s.a.createElement("div",{className:"WACModal__backToBotTooltipBubble"},s.a.createElement("div",{className:"WACModal__backToBotTooltipText WACWidget__breakWord"},r)))),s.a.createElement("div",{className:"WACModal__backToBotTooltipArrow"},s.a.createElement("div",{className:"WACModal__backToBotTooltipArrowPointer"}))))},t}(o.PureComponent),J=Object(P.injectIntl)(K),Y=n(613),X=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonRef=s.a.createRef(),t.localOnClose=function(){(0,t.props.onClose)();t.props.serviceManager.actions.track({eventName:"Widget Closed",eventDescription:"User has closed the widget."})},t}return X(t,e),t.prototype.requestFocus=function(){this.buttonRef.current&&this.buttonRef.current.focus()},t.prototype.render=function(){var e=this.props.languagePack;return s.a.createElement("div",{className:"WAC__headerButtonContainer"},s.a.createElement("button",{ref:this.buttonRef,className:"WAC__header-close WAC__headerButton WAC__button--base WAC__button--ghost",id:"WAC__header-close","aria-label":e.launcher_isOpen,onClick:this.localOnClose,type:"button"},s.a.createElement(Y.a,null)))},t}(o.PureComponent);var $=s.a.memo((function(e){var t=e.element,n=e.id,a=Object(o.useRef)();return Object(o.useEffect)((function(){var e=a.current;return t&&e.appendChild(t),function(){t&&e.removeChild(t)}}),[t]),t?s.a.createElement("div",{ref:a,className:"WAC__RichText",id:n}):null})),ee=n(612),te=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.onReset;return s.a.createElement("div",{className:"WAC__headerButtonContainer"},s.a.createElement("button",{className:"WAC__header-reset WAC__headerButton WAC__button--base WAC__button--ghost",id:"WAC__header-reset","aria-label":t.buttons_reset,onClick:n,type:"button"},s.a.createElement(ee.a,null)))},t}(o.PureComponent),ae=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={mouseOverBackToBot:!1,hideAvatar:!1},t.closeRef=s.a.createRef(),t.toggleAgentRef=s.a.createRef(),t.onMouseOverBackToBotButton=function(){t.setState({mouseOverBackToBot:!0})},t.onMouseOutBackToBotButton=function(){t.setState({mouseOverBackToBot:!1})},t.onAvatarLoadError=function(){t.setState({hideAvatar:!0})},t.onClickClose=function(){t.props.onToggleProcessView(null)},t}return ae(t,e),t.prototype.requestDefaultFocus=function(){this.toggleAgentRef.current?this.toggleAgentRef.current.focus():this.closeRef.current&&this.closeRef.current.requestFocus()},t.prototype.renderBotName=function(){var e=this.props.botName,t=void 0===e?null:e;return s.a.createElement("div",{id:"WAC__header-name",className:"WAC__header-name WACWidget__textEllipsis"},t)},t.prototype.renderProcessInfo=function(e){var t=e.processesByID[e.currentViewedProcessId].processTitle;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"WAC__headerButtons"},s.a.createElement("div",{className:"WAC__headerButtonContainer"},s.a.createElement("button",{type:"button",className:"WAC__headerButton WAC__button--base WAC__button--ghost",onClick:this.onClickClose,"aria-label":this.props.languagePack.thread_closeButton},s.a.createElement("svg",{className:"WAC__header-closeSVG",preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 32 32","aria-hidden":"true"},s.a.createElement("path",{d:"M13 26l1.41-1.41L6.83 17H29v-2H6.83l7.58-7.59L13 6 3 16l10 10z"}))))),s.a.createElement("span",{className:"WAC__header-name"},t))},t.prototype.renderAgentInfo=function(e){var t,n,a=this.props.languagePack,r=e.agentProfile,o=(null===(t=r)||void 0===t?void 0:t.nickname)||(null===(n=r)||void 0===n?void 0:n.full_name)||a.agent_agentNoNameTitle,i=e.isConnected,c=i?a.agent_ariaAgentConnected:a.agent_ariaAgentNotConnected;return s.a.createElement("div",{className:"WAC__headerAgentInfo"},s.a.createElement(V,{agentProfile:r,languagePack:a,width:"32px",height:"32px"}),s.a.createElement("div",{className:"WACWidget__textEllipsis WAC__header-name"},o),s.a.createElement("div",{className:N()("WAC__headerAgentOnlineStatus",{"WAC__headerAgentOnlineStatus--offline":!i}),title:c}))},t.prototype.renderAgentChatButton=function(){var e,t=this.props,n=t.languagePack,a=t.withHumanAgent,r=t.onToggleAgentView,o=t.agentState,i=t.intl,c=t.botName,l=o.numUnreadMessages,u=!a&&0!==l;return a?e=i.formatMessage({id:"agent_ariaToggleViewAgent"},{botName:c}):(e=n.agent_ariaToggleViewBot,u&&(e+=". "+i.formatMessage({id:"icon_ariaUnreadMessages"},{count:l}))),s.a.createElement("div",{className:"WAC__headerButtonContainer"},s.a.createElement("button",{ref:this.toggleAgentRef,type:"button",className:"WAC__headerButton WAC__button--base WAC__button--ghost",onClick:r,onMouseOver:this.onMouseOverBackToBotButton,onMouseOut:this.onMouseOutBackToBotButton,"aria-label":e},s.a.createElement(x.a,null)),u&&s.a.createElement("div",{className:"WAC__countIndicator"},l))},t.prototype.render=function(){var e=this.props,t=e.serviceManager,n=e.languagePack,a=e.onClose,r=e.hideCloseButton,o=e.agentState,i=e.processState,c=e.withHumanAgent,l=e.isProcess,u=e.botName,p=e.botAvatarURL,d=e.intl,m=e.onReset,g=o.wasConnected,f=Object(D.f)(c,l);return s.a.createElement("div",{className:"WAC__headerContainer"},s.a.createElement("div",{id:"WAC__header",className:N()("WAC__header",{"WAC__header--padded":!l})},!c&&!l&&p&&!this.state.hideAvatar&&s.a.createElement("img",{className:"WAC__header-avatar",src:p,onError:this.onAvatarLoadError,alt:d.formatMessage({id:"header_ariaBotAvatar"},{botName:u})}),!c&&!l&&this.renderBotName(),s.a.createElement(J,{withHumanAgent:c,agentState:o,botName:u,languagePack:n,mouseOverTarget:this.state.mouseOverBackToBot}),c&&this.renderAgentInfo(o),l&&this.renderProcessInfo(i),s.a.createElement("div",{className:"WAC__headerButtons"},t.featureSet[R.a.RESET_BUTTON]&&s.a.createElement(ne,{languagePack:n,onReset:m}),g&&this.renderAgentChatButton(),!r&&s.a.createElement(Z,{ref:this.closeRef,serviceManager:t,languagePack:n,onClose:a}))),f===H.a.BOT&&s.a.createElement($,{id:"headerBottomElement",element:t.writeableElements[H.d.HEADER_BOTTOM_ELEMENT]}))},t}(o.PureComponent),oe=Object(P.injectIntl)(re,{forwardRef:!0}),se=n(584),ie=n.n(se),ce=n(611),le=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textAreaRef=s.a.createRef(),t}return le(t,e),t.prototype.takeFocus=function(){this.textAreaRef.current.focus()},t.prototype.render=function(){var e=this.props,t=e.isRequired,n=e.name,a=e.id,r=e.onBlur,o=e.onClick,i=e.onChange,c=e.onKeyDown,l=e.rows,u=e.value,p=e.autoSize,d=e.maxLength,m=e.disabled,g=e.placeholder,f=e.ariaLabel;return s.a.createElement("div",{className:N()("WAC__TextArea",{"WAC__TextArea--autoSize":p,"WAC__TextArea--disabled":m})},s.a.createElement("textarea",{ref:this.textAreaRef,"aria-label":f,"aria-required":t,className:"WAC__TextArea-textarea",disabled:m,id:a,maxLength:d,name:n,onBlur:r,onClick:o,onChange:i,onKeyDown:c,placeholder:g,rows:l,value:u||"","data-enable-grammarly":!1}),p&&s.a.createElement("div",{className:"WAC__TextArea-sizer"},u||" "))},t.defaultProps={isRequired:!1,maxLength:1e4},t}(o.PureComponent),pe=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={inputValue:"",enableFadeOut:!1},t.textAreaRef=s.a.createRef(),t.onKeyDown=function(e){"Enter"===e.key&&(t.props.disableSend?e.preventDefault():t.send(e))},t.onChange=function(e){t.setState({inputValue:e.target.value,enableFadeOut:!0})},t.send=function(e){var n=t.state.inputValue;e.preventDefault();var a=ie()(n).call(n);a.length>0&&(t.props.onSendInput(a),t.setState({inputValue:""}),t.textAreaRef.current.takeFocus())},t}return pe(t,e),t.prototype.takeFocus=function(){G.c||this.textAreaRef.current.takeFocus()},t.prototype.render=function(){var e=this.props,t=e.disableInput,n=e.disableSend,a=e.languagePack,r=a.input_buttonLabel,o=a.input_placeholder,i=this.state,c=i.inputValue,l=i.enableFadeOut,u=t?"":c,p=!c||t||n,d=t?void 0:o;return s.a.createElement("div",{id:"WAC__inputContainer",className:"WAC__inputContainer"},s.a.createElement("label",{id:"WAC__inputLabel",className:"WAC__inputLabel","aria-hidden":"true"},o),s.a.createElement("div",{id:"WAC__inputContainer-TextAreaContainer",className:"WAC__inputContainer-TextAreaContainer"},s.a.createElement(ue,{autoSize:!0,ariaLabel:d,disabled:t,maxLength:300,onChange:this.onChange,onKeyDown:this.onKeyDown,placeholder:d,value:u,ref:this.textAreaRef,id:"WAC__inputContainer-TextArea"}),s.a.createElement("button",{className:N()({"WAC__send-button WAC__button--base WAC__button--primary disabled":!u,"WAC__send-button WAC__button--base WAC__button--primary disabled fade-out":l&&!u,"WAC__send-button WAC__button--base WAC__button--primary ":u}),id:"WAC__send-button",type:"button",onClick:this.send,"aria-label":r,disabled:p},s.a.createElement(ce.a,null))))},t}(o.Component),me=n(6),ge=n.n(me);function fe(e,t){var n=Object(o.useRef)(!1);Object(o.useLayoutEffect)((function(){if(n.current)return e();n.current=!0}),t)}var he=s.a.createContext(null);function _e(){return Object(o.useContext)(he)}var Ce=n(1);function ve(e,t,n,a){if(e)if(e.classList.add(t),"number"==typeof n)p()((function(){e.classList.remove(t),a&&a()}),n);else{var r=function r(o){n&&o.animationName!==n||(e.removeEventListener("animationend",r),e.removeEventListener("animationcancel",r),e.classList.remove(t),a&&a())};e.addEventListener("animationend",r),e.addEventListener("animationcancel",r)}}var Ee=n(69),Ae=n(604);function ye(e){return s.a.createElement("svg",{className:e.className,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12.75 20.64"},s.a.createElement("circle",{cx:"6.07",cy:"18.82",r:"1.82"}),s.a.createElement("path",{d:"M7.28,0H5.46A5.45,5.45,0,0,0,0,5.44v.63H2.43V5.46a3,3,0,0,1,3-3H7.28a3,3,0,1,1,0,6.07H4.86V14H7.28v-3A5.47,5.47,0,1,0,7.28,0Z"}))}function be(e){var t=_e(),n=e.isOpen,a=e.numStrikes,r=Object(o.useRef)(e),i=Object(o.useRef)(),c=t.store.getState().languagePack,l=n?c.quickEscape_ariaButtonToClose:c.quickEscape_ariaButtonToOpen;fe((function(){var t=r.current,o=t.isOpen,s=t.numStrikes,c=a!==s&&0!==a;n!==o?n&&c?ve(i.current,"WACQuickEscapeButton--animate-open-strike",1998):ve(i.current,n?"WACQuickEscapeButton--animate-open":"WACQuickEscapeButton--animate-close",666):c&&ve(i.current,"WACQuickEscapeButton--animate-strike"),r.current=e}));return s.a.createElement("button",{type:"button",className:N()("WACQuickEscapeButton WAC__button--base WAC__button--secondary",{"WACQuickEscapeButton--open":n,"WACQuickEscapeButton--closed":!n}),ref:i,onClick:function(){t.actions.track({eventName:"Quick Escape "+(n?"Closed":"Opened"),eventDescription:"User "+(n?"closed":"opened")+" the quick escape panel."}),t.store.dispatch(Ce.A.setQuickEscapeOpen(!n))},"aria-label":l},s.a.createElement("span",null,s.a.createElement(Ae.a,{className:"WACQuickEscapeButton__XButton"}),s.a.createElement(ye,{className:"WACQuickEscapeButton__Lightning"})))}function We(e){var t=e.relatedResponse,n=e.options,a=e.requestInputFocus,r=e.isOpen,i=_e(),c=i.store.getState().languagePack.quickEscape_ariaListLabel,l=Object(o.useRef)();fe((function(){if(Ee.b){var e=r?"WAC__QuickEscapeOptionsPanel--animate-in":"WAC__QuickEscapeOptionsPanel--animate-out";ve(l.current,e,1e3)}}),[r]);return s.a.createElement("div",{className:"WAC__QuickEscapeOptionsPanel"},s.a.createElement("div",{className:"WAC__button-holder"},s.a.createElement("ul",{ref:l,"aria-label":c},n&&k()(n).call(n,(function(e){return s.a.createElement("li",{key:e.label},s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--round",onClick:function(){return n=e,r=t.thread_id,o=t.id,s=Object(D.a)(n,r,o),i.actions.send(s,{trackEventProps:{eventName:"Quick Escape Response Selected",eventDescription:"User chose an option from the quick escape."}}),void a();var n,r,o,s}},e.label))})))),s.a.createElement("div",{className:"WAC__buttons"}))}var Ne,we=function(){return(we=ge.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Pe=((Ne={})["data-wac-quick-escape-exclude"]="true",Ne);var Oe=s.a.memo((function(e){var t=e.requestInputFocus,n=_e(),a=Object(l.useSelector)((function(e){return e.quickEscapeState})),r=Object(o.useRef)(a),i=a.isOpen,c=a.showButton,u=a.options,p=a.relatedResponse,d=a.numStrikes,m=Object(o.useRef)(),g=Object(o.useRef)(),f=Object(o.useRef)(),h=Object(o.useRef)();return fe((function(){if(Ee.b){var e=r.current,t=e.isOpen,o=e.showButton,s=e.numStrikes;if(c&&d!==s&&0!==d&&ve(f.current,"WACQuickEscapeContainer__Button--animate-strike","WACFadeIn"),i!==t||c!==o){var l=m.current.offsetHeight+"px";h.current.style.display=o?"block":"none",f.current.style.display=o?"block":"none",g.current.style.display=t?"block":"none";var u=m.current.offsetHeight+"px";if(h.current.style.display=null,f.current.style.display=null,g.current.style.display=null,m.current.style.setProperty("--WatsonAssistantChat-Animate-Start-Height",u),m.current.style.setProperty("--WatsonAssistantChat-Animate-End-Height",l),n.store.dispatch(Ce.A.setAppStateValue("suspendScrollDetection",!0)),ve(m.current,"WACQuickEscapeContainer--animate",333,(function(){m.current.style.height=null,n.store.dispatch(Ce.A.setAppStateValue("suspendScrollDetection",!1))})),c!==o){var p=c?"WACQuickEscapeContainer__Button--animate-in":"WACQuickEscapeContainer__Button--animate-out";ve(f.current,p,c?771:333)}}r.current=a}})),s.a.createElement("div",we({className:N()("WACQuickEscapeContainer",{"WACQuickEscapeContainer--open":i,"WACQuickEscapeContainer--closed":!i,"WACQuickEscapeContainer--showButton":c,"WACQuickEscapeContainer--hideButton":!c})},Pe,{ref:m}),s.a.createElement("div",{className:"WACQuickEscapeContainer__Padding",ref:h},s.a.createElement("div",{className:"WACQuickEscapeContainer__Panel",ref:g},s.a.createElement(We,{relatedResponse:p,requestInputFocus:t,options:u,isOpen:i})),s.a.createElement("div",{className:"WACQuickEscapeContainer__Button",ref:f},s.a.createElement(be,{isOpen:i,numStrikes:d}))))})),Re=n(573),Se=function(){return(Se=ge.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function Te(e){return s.a.forwardRef((function(t,n){var a=Object(o.useContext)(he);return s.a.createElement(e,Se({},t,{ref:n,serviceManager:a}))}))}var ke=n(25),Me=n(2);function Ie(e){return null==e}var Be=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),De=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMounted:!1},t.onceAnnounced=!1,t}return Be(t,e),t.prototype.componentDidMount=function(){this.setState({isMounted:!0})},t.prototype.render=function(){var e=this;return s.a.createElement("div",{"aria-live":"polite"},this.state.isMounted&&s.a.createElement(w.c,null,(function(t){var n=t.announcePolite;return e.onceAnnounced||(e.props.announceOnce&&p()((function(){n(e.props.announceOnce)})),e.onceAnnounced=!0),e.props.children})))},t}(o.PureComponent),Le=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCancelClick=function(){t.props.serviceManager.humanAgentService.endChat()},t}return Le(t,e),t.prototype.render=function(){var e,t,n=this.props,a=n.availability,r=n.intl.messages.agent_ariaConnectingCancel;return a&&!Ie(a.estimated_wait_time)?(e="agent_connectingMinutes",t={time:a.estimated_wait_time}):a&&!Ie(a.position_in_queue)?(e="agent_connectingQueue",t={position:a.position_in_queue}):(e="agent_connecting",t={}),s.a.createElement("div",{className:"WAC__agentBanner"},s.a.createElement("div",{className:"WAC__agentBanner-text"},s.a.createElement(De,{announceOnce:r},s.a.createElement(P.FormattedHTMLMessage,{id:e,values:t}))),s.a.createElement("div",{className:"WAC__agentBanner-buttonContainer"},s.a.createElement("button",{type:"button",className:"WAC__agentBanner-button WAC__button--base WAC__button--ghost","aria-label":r,onClick:this.onCancelClick},s.a.createElement(P.FormattedMessage,{id:"buttons_cancel"}))))},t}(s.a.PureComponent);var He=Te(Object(P.injectIntl)(Object(l.connect)((function(e){return{availability:e.agentState.availability}}))(xe)));function Fe(e,t){var n,a=t.ui_state.agentProfile,r=a?a.nickname||a.full_name:null;switch(t.message.response_type){case ke.a.AGENT_JOINED:n=r?"agent_agentJoinedName":"agent_agentJoinedNoName";break;case ke.a.AGENT_LEFT_CHAT:n=r?"agent_agentLeftChat":"agent_agentLeftChatNoName";break;case ke.a.AGENT_ENDED_CHAT:n=r?"agent_agentEndedChat":"agent_agentEndedChatNoName";break;case ke.a.TRANSFER_TO_AGENT:n=r?"agent_transferring":"agent_transferringNoName";break;case ke.a.USER_ENDED_CHAT:n="agent_youEndedChat";break;case ke.a.DISCONNECTED:n="agent_disconnected";break;case ke.a.RECONNECTED:n="agent_reconnected";break;default:return""}return n&&e.formatMessage({id:n},{personName:r})}var je=Object(P.injectIntl)((function(e){return s.a.createElement(o.Fragment,null,Fe(e.intl,e.message))})),Ve=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ve(t,e),t.prototype.render=function(){var e,t=this.props,n=t.message,a=t.languagePack,r=t.onToggleAgentView,o=n.ui_state.agentProfile,i=n.message.response_type;e=i===ke.a.AGENT_JOINED||i===ke.a.AGENT_LEFT_CHAT||i===ke.a.AGENT_ENDED_CHAT||i===ke.a.DISCONNECTED||i===ke.a.RECONNECTED||i===ke.a.TRANSFER_TO_AGENT?Fe(this.props.intl,n):n.message.text;var c=this.props.intl.formatMessage({id:"agent_ariaAgentNewMessage"},{messageText:e});return s.a.createElement(De,null,s.a.createElement("div",{className:"WAC__agentBanner WAC__agentMessageBanner"},s.a.createElement(V,{agentProfile:o,languagePack:a,height:"24px",width:"24px"}),s.a.createElement(w.b,{message:c,"aria-live":"polite"}),s.a.createElement("div",{className:"WAC__agentBanner-text"},s.a.createElement("div",{className:"WAC__agentBanner-textInner"},s.a.createElement("button",{type:"button",className:"WAC__agentMessageBanner-textButton WAC__button--link WACWidget__textEllipsis",onClick:r,"aria-label":a.agent_ariaToggleViewBot},s.a.createElement("span",null,e))))))},t}(s.a.PureComponent),qe=Object(P.injectIntl)(Ue),Qe=n(58),Ge=n.n(Qe);var ze=function(e){var t=e.timestamp;return s.a.createElement("div",{className:"WAC__date"},Ge()(t).format("LLLL"))};var Ke=s.a.memo((function(e){var t=e.welcomeNodeBeforeElement,n=e.children,a=Object(o.useRef)();return Object(o.useEffect)((function(){var e=a.current;return e.appendChild(t),function(){e.removeChild(t)}}),[t]),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{ref:a,className:"WAC__RichText",id:"welcomeNodeBeforeElement"}),n)}));function Je(){return s.a.createElement("span",{"aria-hidden":"true"},s.a.createElement("span",{className:"WAC__loading-ball"}),s.a.createElement("span",{className:"WAC__loading-ball"}),s.a.createElement("span",{className:"WAC__loading-ball"}))}var Ye=n(605),Xe=n(607),Ze=n(18),$e=s.a.createContext(null),et=function(){return(et=ge.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function tt(e){return s.a.forwardRef((function(t,n){var a=Object(o.useContext)($e);return s.a.createElement(e,et({},t,{ref:n,elementAnnouncer:a}))}))}var nt=n(31);function at(e){return s.a.createElement(Ye.a,{className:N()("WACErrorIcon",e.className)})}var rt=function(e){var t=e.text;return s.a.createElement("div",{className:"WAC__inlineError"},s.a.createElement("div",{className:"WAC__inlineError--iconHolder"},s.a.createElement(at,{className:"WAC__inlineError--icon"})),s.a.createElement("div",{className:"WAC__inlineError--text"},t))},ot=n(217),st=n(212),it=n(117),ct=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSelect=function(e,n){var a=t.props,r=a.localMessage,o=a.serviceManager,s=r.originalMessage,i=s.thread_id,c=s.id,l=Object(D.a)(n.item,i,c),u=r.ui_state.id,p={eventName:"Assistant Message Received from User",eventDescription:"User clicks on one of the disamb options.",type:"disambiguation",optionSelected:n.index+1};o.actions.send(l,{trackEventProps:p,setValueSelectedForMessageID:u}),t.props.requestInputFocus()},t}return ct(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.localMessage,a=t.disableUserInputs,r=n.message,i=r.suggestions,c=r.title,l=n.ui_state.optionSelected;return s.a.createElement(o.Fragment,null,s.a.createElement(it.a,{description:c}),s.a.createElement("div",{className:"WAC__button-holder"},s.a.createElement("ul",null,k()(i).call(i,(function(t,n){return s.a.createElement("li",{key:t.label},s.a.createElement(st.a,{className:"WAC__button--base WAC__button--round",boundParameter:{index:n,item:t},id:"WAC__disambigButton-"+n,disabled:a,selected:l&&t.value.input===l.input,onClick:e.onSelect},t.label))})))))},t}(o.Component),ut=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ut(t,e),t.prototype.render=function(){var e=this.props,t=e.messageToHuman,n=e.languagePack,a=n.agent_mockTitle,r=n.agent_mockDescription,o=n.agent_mockMessageLabel,i=t?s.a.createElement("span",null,s.a.createElement("br",null),s.a.createElement("br",null),o,s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("em",null,t)):null;return s.a.createElement("div",{className:"WAC__connectToAgent--textHolder WAC__connectToAgent--preview"},s.a.createElement("div",{className:"WAC__connectToAgent--title"},a),s.a.createElement("div",{className:"WAC__connectToAgent--description"},r," ",i))},t}(o.PureComponent),dt=n(608);var mt=s.a.memo((function(e){var t,n,a=e.languagePack,r=e.disableUserInputs,i=e.showRequestSent,c=e.config,l=e.localMessage,u=a.agent_reason_error,p=a.agent_chatTitle,d=a.agent_chatDescription,m=a.agent_startChat,g=a.agent_chatRequested,f=Object(o.useState)(!1),h=f[0],_=f[1];if(!Object(D.h)(c))throw new Error('The widget attempted to render a "connect_to_agent" message but there is no service desk configured. Check your assistant configuration.');var C,v=i?g:m,E=i||r||h;switch(null===(n=null===(t=l.message.transfer_info)||void 0===t?void 0:t.reason)||void 0===n?void 0:n.type){case O.a.GENERAL_ERROR:case O.a.TRANSFER_FAILURE:C=u;break;default:C=d}return s.a.createElement("div",{className:"WAC__connectToAgent--textHolder"},s.a.createElement("div",{className:"WAC__connectToAgent--title"},s.a.createElement(x.a,null),s.a.createElement("span",null,p)),s.a.createElement("div",{className:"WAC__connectToAgent--description"},C),s.a.createElement("button",{type:"button",className:"WAC__connectToAgent--link",onClick:function(){_(!0),e.serviceManager.humanAgentService.startChat(e.localMessage.originalMessage),e.requestInputFocus()},disabled:E},s.a.createElement("div",{className:"WAC__connectToAgent--link-text"},v),!i&&s.a.createElement(dt.a,null)))})),gt=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gt(t,e),t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.localMessage,a=e.isPreviewLink,r=e.serviceManager,o=e.agentState,i=e.requestInputFocus,c=e.disableStartChat,l=e.config,u=n.message.message_to_human_agent,p=c||o.isConnected||o.isConnecting,d=o.isConnecting||o.isConnected;return s.a.createElement("div",{className:"WAC__connectToAgentHolder"},a&&s.a.createElement(pt,{languagePack:t,messageToHuman:u}),!a&&s.a.createElement(mt,{localMessage:n,serviceManager:r,languagePack:t,disableUserInputs:p,requestInputFocus:i,config:l,showRequestSent:d}))},t}(o.PureComponent);var ht=s.a.memo((function(e){var t=e.serviceManager.customElementRegistry.get(e.messageID),n=Object(o.useRef)();return Object(o.useEffect)((function(){var e=n.current;if(t)return e.appendChild(t),function(){e.removeChild(t)}})),s.a.createElement("div",{ref:n,className:"WAC__message-customResponse WAC__RichText"})})),_t=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Ct=tt(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={loaded:!1,error:!1,announceOnLoad:t.props.needsAnnouncement},t.image=s.a.createRef(),t.ref=s.a.createRef(),t}return _t(t,e),t.prototype.componentDidMount=function(){var e=this,t=function t(){e.setState({error:!0}),e.image.current&&(e.image.current.removeEventListener("load",n),e.image.current.removeEventListener("error",t))},n=function n(){e.state.announceOnLoad&&e.props.elementAnnouncer(e.ref.current),e.setState({loaded:!0,announceOnLoad:!1}),e.image.current&&(e.image.current.removeEventListener("load",n),e.image.current.removeEventListener("error",t))};this.image.current.complete?n():this.image.current&&(this.image.current.addEventListener("load",n),this.image.current.addEventListener("error",t))},t.prototype.render=function(){var e=this.props,t=e.imageError,n=e.source,a=e.title,r=e.description,i=this.state,c=i.loaded,l=i.error;return s.a.createElement("div",{ref:this.ref},!c&&s.a.createElement(o.Fragment,null,l?s.a.createElement(rt,{text:t}):s.a.createElement("div",{className:"WAC__imageHolder"},s.a.createElement("div",{className:"WAC_skeletonLoading WAC__image--loading"}),(a||r)&&s.a.createElement("div",{className:"WAC__image--textHolder"},a&&s.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}),r&&s.a.createElement(o.Fragment,null,s.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}),s.a.createElement("p",{className:"WAC_skeletonLoading WAC_skeletonLoading--text"}))))),!l&&s.a.createElement("div",{className:"WAC__imageHolder"},s.a.createElement("img",{className:N()("WAC__image",{"WAC__image--loaded":c,"WAC__image--error":l,"WAC__image--text":a||r,"WAC__image--no-text":!a&&!r}),src:n,alt:a||r||"",ref:this.image,style:{display:c?"block":"none"}}),(a||r)&&c&&s.a.createElement("div",{className:"WAC__image--textHolder"},a&&s.a.createElement("div",{className:"WAC__image--title"},a),r&&s.a.createElement("div",{className:N()("WAC__image--description",{"WAC__image--description-margin":a&&r})},r))))},t}(o.PureComponent)),vt=n(211),Et=n(147),At=n.n(Et),yt=n(574),bt=n.n(yt);var Wt=n(579),Nt=n.n(Wt),wt=n(62),Pt=n.n(wt),Ot=n(216),Rt=n(454),St=n(455),Tt=n(609),kt=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Mt={eventName:"Assistant Message Received from User",eventDescription:"User clicks on search link.",type:"search"},It=function(e){function t(t){var n=e.call(this,t)||this;return n.toggleExpandedState=function(){n.setState((function(e){return{expanded:!e.expanded}}))},n.state={expanded:!1},n}return kt(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.body,a=e.shouldTruncateBody,r=e.urlIsValid,o=e.languagePack,i=e.url,c=e.serviceManager,l=o.showLess,u=o.showMore,p=this.state.expanded,d=s.a.createElement("span",{className:"WACWidget__textEllipsis"},t),m=s.a.createElement("a",{onClick:function(){return c.actions.track(Mt)},className:"WAC__searchResponseTitle-anchor",href:i,target:"_blank",rel:"noopener noreferrer"},d);return s.a.createElement("div",{className:"WAC__searchResult"},s.a.createElement("div",{className:"WAC__searchResult--padding"},n&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:N()({WAC__searchResponseBody:a,"WAC__searchResponseBody--full":p})},n),a&&s.a.createElement("button",{type:"button",onClick:this.toggleExpandedState,className:"WAC__button--link WAC__searchResponseBody-moreToggle"},s.a.createElement("span",{className:"WAC__searchResponseBody-moreToggle-text"},p?l:u),p?s.a.createElement(Rt.a,{className:"WAC__searchResponseBody-moreToggle-icon"}):s.a.createElement(St.a,{className:"WAC__searchResponseBody-moreToggle-icon"}))),t&&s.a.createElement("div",{className:N()("WAC__searchResponseTitle",{"WAC__searchResponseTitle--noBody":!n})},s.a.createElement(Tt.a,{className:"WAC__Link-svg"}),r?m:d)))},t}(o.PureComponent),Bt=100,Dt=1e3;function Lt(e){if("string"==typeof e&&Pt()(e).call(e,'["')&&Nt()(e).call(e,'"]'))try{e=JSON.parse(e)[0]}catch(e){}return e}function xt(e){return"null"===e?null:e}var Ht=function(e){var t,n,a,r,o,i,c,l,u=e.serviceManager,p=e.searchResult,d=e.languagePack,m=p.url,g=(m=m?Lt(m):void 0)&&Object(Ot.b)(m),f=(null===(n=null===(t=p.highlight)||void 0===t?void 0:t.title)||void 0===n?void 0:n[0])?(i=xt(p.highlight.title[0]))?i.replace(new RegExp("<em>|</em>","g"),""):null:Lt(xt(p.title));function h(){c=Lt(xt(p.body)),l=p.body.length>Bt}return(null===(a=p.body)||void 0===a?void 0:a.length)<=Dt?h():(null===(o=null===(r=p.highlight)||void 0===r?void 0:r.body)||void 0===o?void 0:o[0])?(c=function(e){var t=e.split(new RegExp("<em>|</em>","g"));return t.length%2!=1?[t.join("")]:k()(t).call(t,(function(e,t){var n="formatHighlightFields-"+e+"-"+t;return t%2!=1?e:s.a.createElement("em",{key:n},e)}))}(xt(p.highlight.body[0])),l=p.highlight.body[0].length>Bt):p.body&&h(),(f||c)&&s.a.createElement(It,{title:f,body:c,shouldTruncateBody:l,urlIsValid:g,languagePack:d,url:m,serviceManager:u})},Ft=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}();function jt(e,t){var n,a,r=e&&e.result_metadata?e.result_metadata.confidence:0,o=t&&t.result_metadata?t.result_metadata.confidence:0;return-((n=r)<(a=o)?-1:n>a?1:0)}var Vt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sortedResults=Object(M.a)((function(e){return function(e){var t;return e?bt()(t=At()(e).call(e)).call(t,jt):[]}(e)})),t}return Ft(t,e),t.prototype.renderSearchResponses=function(){for(var e=this.props,t=e.serviceManager,n=e.languagePack,a=e.message,r=this.sortedResults(a.results),o=Math.min(r.length,3),i=[],c=0;c<o;c++){var l=r[c];i.push(s.a.createElement("li",{key:c},s.a.createElement(Ht,{serviceManager:t,languagePack:n,searchResult:l})))}return i},t.prototype.render=function(){var e=this.props,t=e.message,n=e.languagePack,a=t.header,r=t.title,i=this.renderSearchResponses();return s.a.createElement(o.Fragment,null,s.a.createElement("div",{className:"WAC__searchMessage--metablock"},a||r||n.messages_searchResults),s.a.createElement("ul",null,i))},t}(o.PureComponent),Ut=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),qt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ut(t,e),t.prototype.renderSpecificMessage=function(e){if(Object(D.r)(e))return this.renderCustomResponse(e);switch(e.message.response_type){case Ze.b.TEXT:return this.renderText(e);case Ze.b.IMAGE:return this.renderImage(e);case Ze.b.OPTION:return this.renderOption(e);case Ze.b.CONNECT_TO_AGENT:return this.renderConnectToAgent(e);case Ze.b.SUGGESTION:return this.renderSuggestion(e);case Ze.b.SEARCH:return this.renderSearch(e);case ke.b.INLINE_ERROR:return this.renderInlineError(e);case ke.a.AGENT_JOINED:case ke.a.TRANSFER_TO_AGENT:case ke.a.USER_ENDED_CHAT:case ke.a.AGENT_LEFT_CHAT:case ke.a.AGENT_ENDED_CHAT:case ke.a.DISCONNECTED:case ke.a.RECONNECTED:return this.renderAgentStatusMessage(e);default:return this.renderCustomResponse(e)}},t.prototype.renderText=function(e){var t,n=(null===(t=e.originalMessage.history)||void 0===t?void 0:t.label)||e.message.text;if(Object(D.l)(e)){var a=e.ui_state.originalUserText||n;return s.a.createElement("div",null,a)}return s.a.createElement(vt.a,{text:n})},t.prototype.renderOption=function(e){var t=this.props,n=t.languagePack,a=t.requestInputFocus,r=t.serviceManager,o=t.disableUserInputs;return s.a.createElement(ot.a,{localMessage:e,languagePack:n,disableUserInputs:o,requestInputFocus:a,serviceManager:r})},t.prototype.renderSuggestion=function(e){var t=this.props,n=t.requestInputFocus,a=t.serviceManager,r=t.disableUserInputs;return s.a.createElement(lt,{localMessage:e,serviceManager:a,disableUserInputs:r,requestInputFocus:n})},t.prototype.renderImage=function(e){var t=this.props.languagePack;return s.a.createElement(Ct,{imageError:t.errors_imageSource,source:e.message.source,title:e.message.title,description:e.message.description,needsAnnouncement:e.ui_state.needsAnnouncement})},t.prototype.renderSearch=function(e){var t=this.props,n=t.serviceManager,a=t.languagePack;return s.a.createElement(Vt,{serviceManager:n,message:e.message,languagePack:a})},t.prototype.renderInlineError=function(e){return s.a.createElement(rt,{text:e.message.text})},t.prototype.renderAgentStatusMessage=function(e){return s.a.createElement(je,{message:e})},t.prototype.renderCustomResponse=function(e){var t=this.props.serviceManager;return s.a.createElement(ht,{messageID:e.ui_state.id,serviceManager:t})},t.prototype.renderConnectToAgent=function(e){var t=this.props,n=t.languagePack,a=t.serviceManager,r=t.isPreviewLink,o=t.agentState,i=t.requestInputFocus,c=t.disableUserInputs,l=t.config;return s.a.createElement(ft,{serviceManager:a,localMessage:e,languagePack:n,isPreviewLink:r,agentState:o,requestInputFocus:i,disableStartChat:c,config:l})},t.prototype.render=function(){return this.renderSpecificMessage(this.props.rootMessage)},t}(o.Component);function Qt(e){var t=e.text;return s.a.createElement("div",null,t)}var Gt=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){var e=t.props,n=e.processStatus,a=e.currentOngoingProcessId,r=e.currentOngoingProcessStatus;a&&n!==L.a.PROCESS_CANCELLED&&n!==L.a.PROCESS_COMPLETED&&r===L.a.PROCESS_ONGOING&&a!==t.props.localMessage.originalMessage.thread_id?t.props.onConfirmEndChat(t.props.localMessage.originalMessage.thread_id):t.props.onToggleProcessView(t.props.localMessage.originalMessage.thread_id)},t}return Gt(t,e),t.prototype.render=function(){var e,t=this.props,n=t.title,a=t.processStatus,r=t.languagePack,i=r.thread_getStartedButton,c=r.thread_continueButton,l=r.thread_reviewButton,u=r.thread_cancelledButton,p=!1;switch(a){case L.a.PROCESS_COMPLETED:e=l;break;case L.a.PROCESS_CANCELLED:e=u;break;case L.a.PROCESS_NOT_STARTED:e=i,p=!0;break;default:e=c,p=!0}return s.a.createElement(o.Fragment,null,s.a.createElement(Qt,{text:n}),s.a.createElement("div",{className:"WAC__process-launcher"},s.a.createElement("div",{className:"WAC__button-holder"},s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--round",onClick:this.onClick},e,p&&s.a.createElement(dt.a,null)))))},t}(o.PureComponent),Kt=n(155),Jt=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Yt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={didRenderErrorOccur:!1},t.ref=s.a.createRef(),t}return Jt(t,e),t.prototype.getWidgetSaidMessage=function(){var e,t=this.props,n=t.withHumanAgent,a=t.intl,r=t.botName,o=t.localMessage;return n?o.message.response_type===Ze.b.TEXT&&(e="messages_agentSaid"):e="messages_botSaid",e?a.formatMessage({id:e},{botName:r}):null},t.prototype.componentDidCatch=function(){this.setState({didRenderErrorOccur:!0})},t.prototype.componentDidMount=function(){var e=this.props.localMessage.ui_state;e.needsAnnouncement&&(this.props.elementAnnouncer(this.ref.current),this.props.serviceManager.store.dispatch(Ce.A.setMessageWasAnnounced(e.id)))},t.prototype.renderFailedRenderMessage=function(){return s.a.createElement("div",{className:"WAC__message WAC__message--inlineError",ref:this.ref},s.a.createElement("div",{className:"WAC__message--padding"},s.a.createElement("div",{className:"WAC__bot-message"},s.a.createElement(Kt.a,null,this.getWidgetSaidMessage()),s.a.createElement("div",{className:"WAC__bot-bar"}),s.a.createElement("div",{className:"WAC__received WAC__received--text"},s.a.createElement(rt,{text:this.props.languagePack.errors_singleMessage})))))},t.prototype.renderAvatar=function(e,t){var n,a=this.props,r=a.withHumanAgent,o=a.languagePack;if(r)switch(e.message.response_type){case ke.a.AGENT_JOINED:case ke.a.AGENT_LEFT_CHAT:case ke.a.AGENT_ENDED_CHAT:case ke.a.TRANSFER_TO_AGENT:case ke.a.USER_ENDED_CHAT:case ke.a.DISCONNECTED:case ke.a.RECONNECTED:n=!1;break;default:n=!0}else n=t;if(!n)return s.a.createElement("div",{className:"WAC__bot-bar--hidden"});if(r){var i=e.ui_state.agentProfile;return s.a.createElement("div",{className:"WAC__agentMessageAvatar"},s.a.createElement(V,{agentProfile:i,languagePack:o,width:"24px",height:"24px"}))}return s.a.createElement("div",{className:t?"WAC__bot-bar":"WAC__bot-bar--hidden"})},t.prototype.renderErrorState=function(e){var t,n,a=this.props.languagePack;switch(e){case nt.a.FAILED:t=s.a.createElement(Ye.a,{"aria-label":a.errors_ariaMessageFailed}),n="WAC__message-error-failed";break;case nt.a.RETRYING:t=s.a.createElement(Xe.a,{"aria-label":a.errors_ariaMessageRetrying}),n="WAC__message-error-retrying"}return t&&s.a.createElement("div",{className:"WAC__message-error "+n},t)},t.prototype.render=function(){if(this.state.didRenderErrorOccur)return this.renderFailedRenderMessage();var e=this.props,t=e.serviceManager,n=e.config,a=e.localMessage,r=e.languagePack,o=e.requestInputFocus,i=e.isPreviewLink,c=e.messagesIndex,l=e.agentState,u=e.onConfirmEndChat,p=e.onToggleProcessView,d=e.isProcess,m=e.processStatus,g=e.isLatestWelcomeNodesActive,f=e.currentOngoingProcessId,h=e.currentOngoingProcessStatus,_=e.disableUserInputs,C=e.showBotMarker,v=e.className,E=a.message.response_type;if(Object(D.p)(a.message))return!1;var A=a.ui_state,y=A.errorState,b=A.processLauncher,W=A.partOfMessageID,w=A.id,P=A.fromHistory,O=W===w,S=t.featureSet[R.a.THREADS]&&b&&!d,T=_||P||m===L.a.PROCESS_CANCELLED||m===L.a.PROCESS_COMPLETED,k=S?s.a.createElement(zt,{title:Object(L.d)(a),processStatus:m,localMessage:a,serviceManager:t,languagePack:r,currentOngoingProcessId:f,currentOngoingProcessStatus:h,onConfirmEndChat:u,onToggleProcessView:p}):s.a.createElement(qt,{serviceManager:t,isPreviewLink:i,languagePack:r,requestInputFocus:o,rootMessage:a,agentState:l,disableUserInputs:T,config:n}),M=Object(D.r)(a);return s.a.createElement("div",{id:"WAC__message-"+c,className:N()("WAC__message",v,{"WAC__message--no-animation":a.ui_state.isLatestWelcomeNode&&!g,"WAC__message--custom":M,"WAC__message--disabled-inputs":T}),ref:this.ref},s.a.createElement("div",{className:"WAC__message--padding"},Object(D.m)(a)&&s.a.createElement("div",{className:"WAC__bot-message"},O&&s.a.createElement(Kt.a,null,this.getWidgetSaidMessage()),this.renderAvatar(a,C&&!M),s.a.createElement("div",{className:N()("WAC__received",{"WAC__received--text":"text"===E||S,"WAC__received--image":"image"===E,"WAC__received--options":"option"===E,"WAC__received--search":"search"===E,"WAC__received--suggestion":"suggestion"===E,"WAC__received--welcome":"welcome"===E,"WAC__received--inlineError":E===ke.b.INLINE_ERROR,"WAC__received--previewAgent":"connect_to_agent"===E&&i,"WAC__received--agentStatusMessage":E===ke.a.AGENT_JOINED||E===ke.a.AGENT_LEFT_CHAT||E===ke.a.AGENT_ENDED_CHAT||E===ke.a.TRANSFER_TO_AGENT||E===ke.a.USER_ENDED_CHAT||E===ke.a.DISCONNECTED||E===ke.a.RECONNECTED,"WAC__message--historical":P})},k)),Object(D.l)(a)&&s.a.createElement("div",{className:"WAC__sentAndError-container"},s.a.createElement("div",{className:N()("WAC__sent",{"WAC__sent--error":y===nt.a.FAILED,"WAC__sent--retrying":y===nt.a.RETRYING,"WAC__sent--waiting":y===nt.a.WAITING})},s.a.createElement(Kt.a,null,r.messages_youSaid),k),y!==nt.a.NONE&&this.renderErrorState(y))))},t}(o.PureComponent),Xt=tt(Object(P.injectIntl)(Yt,{forwardRef:!0})),Zt=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),$t=Object(M.a)((function(){return{right:Object(Ee.a)(),width:"calc(100% - "+Object(Ee.a)()}}));var en=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollHandleHasFocus:!1},t.messageRefs=[],t.endChatContainerRef=s.a.createRef(),t.scrollingContainerRef=s.a.createRef(),t.scrollHandleRef=s.a.createRef(),t.onResize=function(){if(t.props.messageState.isScrollAnchored){var e=t.scrollingContainerRef.current;e&&(e.scrollTop=e.scrollHeight)}},t}return Zt(t,e),t.prototype.componentDidMount=function(){var e=this;this.doAutoScroll(),this.scrollPanelObserver=new Re.a(this.onResize),this.scrollPanelObserver.observe(this.scrollingContainerRef.current),this.scrollingContainerRef.current.addEventListener("scroll",(function(){return e.checkScrollAnchor()})),this.scrollHandleRef.current.addEventListener("focus",(function(){return e.setState({scrollHandleHasFocus:!0})})),this.scrollHandleRef.current.addEventListener("blur",(function(){return e.setState({scrollHandleHasFocus:!1})})),this.previousScrollOffsetHeight=this.scrollingContainerRef.current.offsetHeight},t.prototype.componentDidUpdate=function(e){e.messages.length===this.props.messages.length&&e.messageState.isTypingCounter===this.props.messageState.isTypingCounter||this.doAutoScroll()},t.prototype.componentWillUnmount=function(){this.scrollPanelObserver.unobserve(this.scrollingContainerRef.current)},t.prototype.checkScrollAnchor=function(e,t){var n=this.scrollingContainerRef.current;if(e||this.previousScrollOffsetHeight===n.offsetHeight&&!this.props.suspendScrollDetection){var a=(void 0!==t?t:n.scrollTop)>=n.scrollHeight-n.offsetHeight;if(a!==this.props.messageState.isScrollAnchored){var r=Object(D.f)(this.props.withHumanAgent,this.props.isProcess);this.props.serviceManager.store.dispatch(Ce.A.setIsScrollAnchored(a,e,r))}}this.previousScrollOffsetHeight=n.offsetHeight},t.prototype.doAutoScroll=function(){try{var e=this.props,t=e.messages,n=e.messageState.isTypingCounter,a=this.scrollingContainerRef.current,r=!0,o=void 0,s=t.length-1,i=t.length?t[s]:null,c=i&&i.ui_state.isLatestWelcomeNode?this.findFirstWelcomeNodeIndex(t):-1;if(i)if(i.ui_state.fromHistory)r=!1,o=a.scrollHeight;else if(-1!==c){r=!1,o=this.messageRefs[c].ref.current.offsetTop}else if(0===n&&Object(D.l)(i)){o=this.messageRefs[s].ref.current.offsetTop}else if(n>0&&Object(D.l)(i))o=a.scrollHeight;else{for(var l=t.length-2,u=void 0;l>=0;){var p=t[l];if(Object(D.l)(p)){u=this.messageRefs[l];break}l--}if(u){var d=u.ref.current;o=d.offsetTop+d.offsetHeight+1}else o=-1}else r=!1,o=0;-1!==o&&(this.endChatContainerRef.current&&(o-=this.endChatContainerRef.current.offsetHeight),o>=a.scrollTop&&(Object(Ee.d)(a,o,0,r),this.checkScrollAnchor(!0,o)))}catch(e){Object(Me.b)("An error occurred while attempting to scroll.",e)}},t.prototype.findFirstWelcomeNodeIndex=function(e){for(var t=e.length-1;t>=0;){if(0===t&&e[t].ui_state.isLatestWelcomeNode)return t;if(t>0&&!e[t-1].ui_state.isLatestWelcomeNode)return t;t--}return e.length-1},t.prototype.shouldShowDate=function(e){var t=this.props.messages;if(t.length>1){var n=t[e-1],a=t[e];if(function(e,t){return!!(e&&e.ui_state&&e.ui_state.localizedDate&&t&&t.ui_state&&t.ui_state.localizedDate)}(a,n))return a.ui_state.localizedDate!==n.ui_state.localizedDate}return!1},t.prototype.shouldShowBotMarker=function(e,t,n){return e.ui_state.id===n&&e.message.response_type!==ke.b.INLINE_ERROR},t.prototype.renderTypingIndicator=function(e){return s.a.createElement("div",{className:"WAC__message"},e&&s.a.createElement(w.b,{message:e,"aria-live":"polite"}),s.a.createElement("div",{className:"WAC__bot-message"},s.a.createElement("div",{className:"WAC__bot-bar--hidden"}),s.a.createElement("div",{className:"WAC__received--loading"},s.a.createElement(Je,null))))},t.prototype.renderMessage=function(e,t,n,a,r,i){var c,l,u=this,p=this.props,d=p.serviceManager,m=p.config,g=p.languagePack,f=p.requestInputFocus,h=p.isPreviewLink,_=p.withHumanAgent,C=p.agentState,v=p.processState,E=p.botName,A=p.onConfirmEndChat,y=p.onToggleProcessView,b=p.isProcess,W=e.originalMessage,N=v.processesByID[v.currentOngoingProcessId];N&&(c=N.processStatus);var w=v.processesByID[W.thread_id];w&&(l=w.processStatus);var P=0===t?"WAC__message--firstMessage":void 0,O=s.a.createElement(s.a.Fragment,null,!e.ui_state.isLatestWelcomeNode&&W.history&&this.shouldShowDate(t)&&s.a.createElement(ze,{timestamp:W.history.timestamp}),s.a.createElement(Xt,{ref:function(e){u.messageRefs[t]=e},className:P,isLatestWelcomeNodesActive:n,config:m,localMessage:e,languagePack:g,requestInputFocus:f,serviceManager:d,isPreviewLink:h,messagesIndex:t,withHumanAgent:_,onConfirmEndChat:A,agentState:C,processStatus:l,botName:E,onToggleProcessView:y,isProcess:b,currentOngoingProcessId:v.currentOngoingProcessId,currentOngoingProcessStatus:c,disableUserInputs:a,showBotMarker:r}));return i?s.a.createElement(Ke,{welcomeNodeBeforeElement:d.writeableElements[H.d.WELCOME_NODE_BEFORE_ELEMENT],key:t},O):s.a.createElement(o.Fragment,{key:t},O)},t.prototype.renderAgentConnectingBanner=function(){return this.props.agentState.isConnecting&&s.a.createElement(He,null)},t.prototype.renderScrollHandle=function(){var e=this.props.languagePack.messages_scrollHandle;return s.a.createElement("div",{className:"WACMessages-scrollHandle",ref:this.scrollHandleRef,tabIndex:0,"aria-label":e})},t.prototype.renderAgentMessageBanner=function(){var e=this.props,t=e.agentState,n=e.withHumanAgent,a=e.languagePack,r=e.onToggleAgentView;return!n&&t.lastUnreadMessage&&s.a.createElement(qe,{message:t.lastUnreadMessage,languagePack:a,onToggleAgentView:r})},t.prototype.renderEndChat=function(){var e=this.props,t=e.agentState,n=e.withHumanAgent,a=e.languagePack,r=e.onConfirmEndChat;return n&&(t.isConnected||t.isConnecting)?s.a.createElement("div",{className:"WAC__messagesEndChatPadding",ref:this.endChatContainerRef,style:$t()},s.a.createElement("div",{className:"WAC__messagesEndChatContainer"},s.a.createElement("button",{type:"button",className:"WAC__messagesEndChatButton WAC__button--base WAC__button--round",onClick:r},a.agent_endChat))):null},t.prototype.isMostRecentWelcomeNodeFirstMessage=function(e){var t=this.props.messages[e];return t.ui_state.isLatestWelcomeNode&&t.ui_state.partOfMessageID===t.ui_state.id},t.prototype.renderMessages=function(e,t,n,a,r){for(var o=this.props.messages,s=[],i=e;i<o.length;i++){var c=o[i];if(t&&c.ui_state.isLatestWelcomeNode)break;var l=c.ui_state.partOfMessageID!==a,u=this.shouldShowBotMarker(c,i,r),p=this.isMostRecentWelcomeNodeFirstMessage(i);s.push(this.renderMessage(c,i,n,l,u,p))}return s},t.prototype.render=function(){var e,t,n,a=this.props,r=a.messages,o=a.messageState,i=a.withHumanAgent,c=a.intl,l=a.botName,u=o.isTypingCounter,p=this.state.scrollHandleHasFocus,d=r[r.length-1];this.messageRefs.length=r.length;var m,g=this.renderEndChat(),f=null===(e=d)||void 0===e?void 0:e.ui_state.partOfMessageID,h=null===(t=Object(S.d)(r,D.m))||void 0===t?void 0:t.ui_state.partOfMessageID,_=null===(n=d)||void 0===n?void 0:n.ui_state.isLatestWelcomeNode,C=this.renderMessages(0,_,!1,f,h),v=null;if(C.length!==r.length&&(v=this.renderMessages(C.length,!1,!0,f,h)),u){var E=i?"messages_agentIsTyping":"messages_botIsTyping";m=c.formatMessage({id:E},{botName:l})}return s.a.createElement("div",{id:"WAC__messages-holder",className:"WAC__messages-holder"},this.renderAgentConnectingBanner(),this.renderAgentMessageBanner(),s.a.createElement("div",{id:"WAC__messages",className:N()("WAC__messages",{WAC__messagesWithEndChat:Boolean(g),"WAC__messages--scrollHandleHasFocus":p}),ref:this.scrollingContainerRef},this.renderScrollHandle(),g,C,v&&v.length>0&&s.a.createElement("div",{className:N()("WAC__message--welcome",{"WAC__message--welcome--typing":u})},v,u>0&&this.renderTypingIndicator(m)),u>0&&!v&&this.renderTypingIndicator(m)))},t}(o.PureComponent),tn=Te(Object(l.connect)((function(e){return e}),null,null,{forwardRef:!0})(en)),nn=n(98);function an(e){var t=Object(P.useIntl)(),n=e.botName,a=e.errorType===nn.a.THROTTLED?"errors_busy":"errors_communicating",r=t.formatMessage({id:a},{botName:n});return s.a.createElement("div",{id:"WAC__messages-holder",className:"WAC__messages-holder WAC__messages-error"},s.a.createElement(rt,{text:r}))}var rn=function(){return(rn=ge.a||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var on=function(e){var t=e.className?"WAC__LoadingSpinner "+e.className:"WAC__LoadingSpinner";return s.a.createElement("div",rn({},e,{className:t}),s.a.createElement("svg",{viewBox:"-18 -18 36 36",focusable:"false","aria-hidden":"true"},s.a.createElement("circle",{strokeWidth:"4",cx:"0",cy:"0",r:"16"})))},sn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),cn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showChildren:!1},t}return sn(t,e),t.prototype.componentDidMount=function(){var e=this;this.onComponentDidMount=p()((function(){e.setState({showChildren:!0})}),this.props.delay)},t.prototype.componentWillUnmount=function(){clearTimeout(this.onComponentDidMount),this.onComponentDidMount=void 0},t.prototype.render=function(){return!!this.state.showChildren&&this.props.children},t.defaultProps={delay:500},t}(o.PureComponent);function ln(){return s.a.createElement("div",{id:"WAC__messages-holder",className:"WAC__messages-holder WAC__messages-loading"},s.a.createElement(cn,null,s.a.createElement(on,{className:"WAC__messages-loadingSpinner"})))}var un=n(167),pn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),dn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.noButtonRef=s.a.createRef(),t.yesButtonRef=s.a.createRef(),t.lastButtonWithFocus=null,t.onYesClick=function(){t.props.onConfirm()},t.onNoClick=function(){t.props.onCancel()},t.onKeyDown=function(e){"Escape"===e.key&&t.props.onCancel()},t.onElementMouseEvent=function(e){e.target!==t.yesButtonRef.current&&e.target!==t.noButtonRef.current&&(e.preventDefault(),e.stopPropagation())},t.onElementFocus=function(e){e.target===t.yesButtonRef.current?t.lastButtonWithFocus="yes":e.target===t.noButtonRef.current?t.lastButtonWithFocus="no":"no"===t.lastButtonWithFocus?Object(Ee.c)(t.yesButtonRef):Object(Ee.c)(t.noButtonRef)},t}return pn(t,e),t.prototype.componentDidMount=function(){this.noButtonRef.current&&this.noButtonRef.current.focus();var e=this.context||document;e.addEventListener("focusin",this.onElementFocus,!0),e.addEventListener("click",this.onElementMouseEvent,!0),e.addEventListener("mousedown",this.onElementMouseEvent,!0)},t.prototype.componentWillUnmount=function(){var e=this.context||document;e.removeEventListener("focusin",this.onElementFocus,!0),e.removeEventListener("click",this.onElementMouseEvent,!0),e.removeEventListener("mousedown",this.onElementMouseEvent,!0)},t.prototype.renderFocusGuard=function(){return s.a.createElement(Kt.a,{tabIndex:0})},t.prototype.render=function(){var e=this.props,t=e.title,n=e.message,a=e.cancelButtonLabel,r=e.confirmButtonLabel,o=e.modalAnnounceMessage;return s.a.createElement("div",{className:"WACConfirmModal",role:"dialog","aria-labelledby":"WACConfirmModal__title","aria-describedby":"WACConfirmModal__message"},s.a.createElement("div",{className:"WACConfirmModal__container"},s.a.createElement(w.b,{message:o,"aria-live":"polite"}),s.a.createElement("div",{className:"WACConfirmModal__title",id:"WACConfirmModal__title"},t),s.a.createElement("div",{className:"WACConfirmModal__message",id:"WACConfirmModal__message"},n),this.renderFocusGuard(),s.a.createElement("div",{className:"WACConfirmModal__buttonContainer"},s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--secondary",ref:this.noButtonRef,onClick:this.onNoClick,onKeyDown:this.onKeyDown},a),s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--primary",ref:this.yesButtonRef,onClick:this.onYesClick,onKeyDown:this.onKeyDown},r)),this.renderFocusGuard()))},t.contextType=un.a,t}(o.Component),mn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),gn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onResume=function(){t.props.onToggleProcessView(t.props.currentProcessId)},t.onCancel=function(){t.props.onConfirmEndChat()},t}return mn(t,e),t.prototype.render=function(){var e=this.props,t=e.currentProcessId,n=e.process,a=e.languagePack;if(!t||!n||0===n.messageIDs.length||n.processStatus===L.a.PROCESS_COMPLETED||n.processStatus===L.a.PROCESS_CANCELLED||n.processStatus===L.a.PROCESS_NOT_STARTED)return null;var r=a.thread_label,o=a.thread_resumeButton,i=a.thread_cancelButton,c=a.thread_in_progress_announce,l=a.thread_in_progress_resume_description,u=a.thread_in_progress_cancel_description;return s.a.createElement("div",{className:"WAC__process-in-progress"},s.a.createElement(w.b,{message:c,"aria-live":"polite"}),s.a.createElement("div",{className:"WAC__process-in-progress-text"},r," ",s.a.createElement("b",{className:"WACWidget__textEllipsis"},n.processTitle)),s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--ghost",onClick:this.onResume,"aria-label":l},o),s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--ghost",onClick:this.onCancel,"aria-label":u},i))},t}(o.Component);function fn(e){var t,n,a=e.progress,r=void 0===a?0:a,i=(t=r,n=Object(o.useRef)(),Object(o.useEffect)((function(){n.current=t})),n.current||0)<=r;return s.a.createElement("div",{className:"WAC__SentMessageProgress"},i&&s.a.createElement("div",{className:"WAC__SentMessageProgress_Bar",style:{width:r+"%"}}))}var hn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),_n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showEndChatConfirmation:!1,endChatConfirmationID:null},t.inputRef=s.a.createRef(),t.headerRef=s.a.createRef(),t.messagesRef=s.a.createRef(),t.processDoneButtonRef=s.a.createRef(),t.messagesToArray=Object(M.a)((function(e,t){return k()(e).call(e,(function(e){return t[e]}))}),I),t.onSendInputInThread=function(e){var n=t.props;(0,n.onSendInput)(e,n.threadID)},t.hideConfirmEndChat=function(){t.setState({showEndChatConfirmation:!1,endChatConfirmationID:null}),t.requestInputFocus()},t.showConfirmEndChat=function(e){t.setState({showEndChatConfirmation:!0,endChatConfirmationID:e})},t.confirmAgentEndChat=function(){t.props.serviceManager.humanAgentService.endChat().then(t.hideConfirmEndChat)},t.confirmProcessEndChat=function(){t.props.onToggleProcessView(t.state.endChatConfirmationID),t.hideConfirmEndChat()},t.confirmProcessCancelChat=function(){t.props.serviceManager.actions.cancelProcess(t.props.processState.currentOngoingProcessId),t.hideConfirmEndChat()},t.onClickDone=function(){t.props.onToggleProcessView(null)},t.requestInputFocus=function(){!t.shouldDisableInput()&&t.inputRef.current?t.inputRef.current.takeFocus():t.headerRef.current&&t.headerRef.current.requestDefaultFocus()},t.doAutoScroll=function(){t.messagesRef.current&&t.messagesRef.current.doAutoScroll()},t}return hn(t,e),t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.isProcess,a=t.processState;if(this.props.isVisible&&!e.isVisible)n&&this.isProcessEnded()?this.focusProcessDoneButton():this.requestInputFocus();else if(n&&a.isProcessPanelOpen){var r=e.processState.processesByID[a.currentViewedProcessId];this.isProcessEnded()&&r.processStatus!==L.a.PROCESS_COMPLETED&&r.processStatus!==L.a.PROCESS_CANCELLED&&this.focusProcessDoneButton()}},t.prototype.getBotName=function(){var e=this.props,t=e.languagePack,n=e.botName;return e.isPreviewLink?t.header_previewLinkTitle:n},t.prototype.focusProcessDoneButton=function(){this.processDoneButtonRef&&this.processDoneButtonRef.current&&this.processDoneButtonRef.current.focus()},t.prototype.isProcessEnded=function(){var e=this.props.processState,t=e.processesByID[e.currentViewedProcessId];return t&&(t.processStatus===L.a.PROCESS_COMPLETED||t.processStatus===L.a.PROCESS_CANCELLED)},t.prototype.shouldDisableInput=function(){var e=this.props,t=e.withHumanAgent,n=e.agentState,a=e.processState,r=e.allMessagesByID,o=e.isProcess,s=a.processesByID[a.currentViewedProcessId];if(o&&s){var i=Object(S.e)(s.messageIDs,r,D.m);if(Object(D.n)(i))return!0}return t&&!n.allowUserInput},t.prototype.shouldDisableSend=function(){var e=this.props.isHydrated;return this.shouldDisableInput()||!e},t.prototype.renderMessagesAndInput=function(){var e=this.props,t=e.languagePack,n=e.isPreviewLink,a=e.onToggleAgentView,r=e.onToggleProcessView,o=e.withHumanAgent,i=e.isProcess,c=e.messageState,l=e.intl,u=e.allMessagesByID,p=e.isHydrated,d=e.showWelcomeError,m=e.sentMessagePercentage,g=e.serviceManager,f=this.getBotName(),h=g.featureSet[R.a.QUICK_ESCAPE];if(d)return s.a.createElement(an,{botName:f,errorType:d});var _=t.thread_doneButton;return s.a.createElement(s.a.Fragment,null,p&&s.a.createElement("div",{className:"WACAgentContainer__NonInputContainer"},s.a.createElement(tn,{ref:this.messagesRef,messageState:c,messages:this.messagesToArray(c.messageIDs,u),requestInputFocus:this.requestInputFocus,isPreviewLink:n,withHumanAgent:o,onToggleAgentView:a,onConfirmEndChat:this.showConfirmEndChat,botName:f,intl:l,onToggleProcessView:r,isProcess:i}),(!i||!this.isProcessEnded())&&s.a.createElement(s.a.Fragment,null,!o&&h&&s.a.createElement(Oe,{requestInputFocus:this.requestInputFocus}),s.a.createElement(fn,{progress:m}))),!p&&s.a.createElement(ln,null),(!i||!this.isProcessEnded())&&s.a.createElement(de,{ref:this.inputRef,languagePack:t,serviceManager:g,disableInput:this.shouldDisableInput(),disableSend:this.shouldDisableSend(),onSendInput:this.onSendInputInThread}),o&&this.state.showEndChatConfirmation&&s.a.createElement(dn,{title:t.agent_endChat,message:t.agent_confirmEndChat,onConfirm:this.confirmAgentEndChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.agent_confirmEndChatNo,confirmButtonLabel:t.agent_confirmEndChatYes,modalAnnounceMessage:t.agent_confirmEndChat}),!o&&this.state.showEndChatConfirmation&&this.state.endChatConfirmationID&&s.a.createElement(dn,{title:t.thread_confirmModalTitle,message:t.thread_confirmModalDescription,onConfirm:this.confirmProcessEndChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.thread_confirmModalNo,confirmButtonLabel:t.thread_confirmModalYes,modalAnnounceMessage:t.thread_confirmNewThread}),!o&&this.state.showEndChatConfirmation&&!this.state.endChatConfirmationID&&s.a.createElement(dn,{title:t.thread_cancelModalTitle,message:t.thread_cancelModalDescription,onConfirm:this.confirmProcessCancelChat,onCancel:this.hideConfirmEndChat,cancelButtonLabel:t.thread_confirmModalNo,confirmButtonLabel:t.thread_confirmModalYes,modalAnnounceMessage:t.thread_confirmNewThread}),i&&this.isProcessEnded()&&s.a.createElement("button",{type:"button",className:"WAC__button--base WAC__button--primary WAC__process-wizard-done-button",onClick:this.onClickDone,ref:this.processDoneButtonRef},_))},t.prototype.render=function(){var e=this.props,t=e.serviceManager,n=e.botAvatarURL,a=e.languagePack,r=e.hideCloseButton,o=e.onClose,i=e.onToggleAgentView,c=e.onToggleProcessView,l=e.withHumanAgent,u=e.isProcess,p=e.agentState,d=e.processState,m=e.onReset,g=e.showQuickEscapeButton,f=this.getBotName(),h=d.processesByID[d.currentOngoingProcessId];return s.a.createElement("div",{className:N()("WAC",{"WACChat--showQuickEscapeButton":g})},s.a.createElement(oe,{ref:this.headerRef,serviceManager:t,botName:f,botAvatarURL:n,languagePack:a,hideCloseButton:r,onClose:o,onToggleAgentView:i,onToggleProcessView:c,agentState:p,processState:d,withHumanAgent:l,isProcess:u,onReset:m}),!l&&!u&&!this.state.showEndChatConfirmation&&s.a.createElement(gn,{currentProcessId:d.currentOngoingProcessId,process:h,onToggleProcessView:c,onConfirmEndChat:this.showConfirmEndChat,languagePack:a}),s.a.createElement("div",{className:"WAC__messagesAndInputContainer"},this.renderMessagesAndInput()))},t}(o.Component),Cn=Object(P.injectIntl)(_n,{forwardRef:!0}),vn=n(7),En=n.n(vn),An=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),yn=new m.a(["SCRIPT","STYLE","CANVAS","IFRAME","OBJECT","EMBED","LINK","TEMPLATE"]),bn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ref1=s.a.createRef(),t.ref2=s.a.createRef(),t.useRef1=!0,t.doAnnouncement=function(){var e,n=t.useRef1?t.ref1.current:t.ref2.current;En()(e=t.pendingElements).call(e,(function(e){var a=e.cloneNode(!0);t.sanitizeElement(a),n.appendChild(a)})),(t.useRef1?t.ref2.current:t.ref1.current).innerHTML="",t.useRef1=!t.useRef1,t.pendingElements=null},t}return An(t,e),t.prototype.announceElement=function(e){e&&(this.pendingElements||(this.pendingElements=[],p()(this.doAnnouncement)),this.pendingElements.push(e))},t.prototype.sanitizeElement=function(e){if(yn.has(e.tagName))Object(Ee.g)(e);else{var t;En()(t=e.getAttributeNames()).call(t,(function(t){(Pt()(t).call(t,"on")||"id"===t||"autoplay"===t||"preload"===t)&&e.removeAttribute(t)})),e.setAttribute("tabIndex","-1");for(var n=e.firstElementChild;n;){var a=n.nextElementSibling;this.sanitizeElement(n),n=a}}},t.prototype.render=function(){return s.a.createElement(Kt.a,{className:"WACElementAnnouncer"},s.a.createElement("div",{ref:this.ref1,"aria-live":"polite"}),s.a.createElement("div",{ref:this.ref2,"aria-live":"polite"}))},t}(s.a.PureComponent);var Wn=s.a.memo((function(e){var t=e.announcement,n=Object(P.useIntl)(),a=Object(o.useState)(""),r=a[0],i=a[1],c=Object(o.useState)(0),l=c[0],u=c[1],d=Object(o.useRef)();if(t&&t!==d.current){var m="";m=t.messageID?n.formatMessage({id:t.messageID},t.messageValues):t.messageText;var g=t.numSetTimeouts||0;!function e(){g>0?(g--,p()(e)):(i(m),m===r&&u(l+1))}(),d.current=t}return s.a.createElement(w.b,{key:l,message:r,"aria-live":"polite"})})),Nn=s.a.createContext(null),wn=n(43),Pn=n(614),On=s.a.createContext(null),Rn=n(144),Sn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),Tn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonRef=s.a.createRef(),t.requestFocus=function(){Object(Ee.c)(t.buttonRef,!0)},t.toggleLauncher=function(){t.props.onToggleOpen(),t.props.serviceManager.actions.track({eventName:"Widget Opened",eventDescription:"User has opened the widget."})},t}return Sn(t,e),t.prototype.componentDidMount=function(){var e=this.context.optimizely;Object(Rn.b)(e,"LAUNCHER_COLOR",this.props.serviceManager.actions,{eventName:"Widget Loaded",eventDescription:"The launcher button is rendered."})},t.prototype.render=function(){var e=this.props,t=e.uuid,n=e.isOpen,a=e.languagePack,r=e.unreadAgentCount,o=e.intl,i=n?a.launcher_isOpen:a.launcher_isClosed;return 0!==r&&(i+=". "+o.formatMessage({id:"icon_ariaUnreadMessages"},{count:r})),s.a.createElement("div",{className:N()("WACLauncher__ButtonContainer",{"WACLauncher__ButtonContainer--open":n})},s.a.createElement("button",{"aria-label":i,className:"WACLauncher__Button WACLauncher--"+t+" WAC__button--base WAC__button--primary",id:"WACLauncher__Button",type:"button",onClick:this.toggleLauncher,ref:this.buttonRef},s.a.createElement(Pn.a,{className:N()("WACLauncher__svg",{"WACLauncher__svg--open":n})}),0!==r&&s.a.createElement("div",{className:"WAC__countIndicator"},r)))},t.contextType=On,t}(o.PureComponent),kn=Object(P.injectIntl)(Tn,{forwardRef:!0}),Mn=function(){var e=function(t,n){return(e=b.a||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?A()(n):(a.prototype=n.prototype,new a)}}(),In=function(e,t,n,a){return new(n||(n=v.a))((function(r,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},Bn=function(e,t){var n,a,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof _.a&&(o[f.a]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},Dn=new m.a(["Tab","Shift","Control","Alt","Meta","CapsLock","Fn"]),Ln=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={closing:!1,open:t.props.isOpen,openedOnce:t.props.isOpen||t.props.config.public.openChatByDefault,modalPortalHostElement:null,processOpening:!1,processClosing:!1},t.containerRef=s.a.createRef(),t.botChatRef=s.a.createRef(),t.agentChatRef=s.a.createRef(),t.processChatRef=s.a.createRef(),t.launcherRef=s.a.createRef(),t.elementAnnouncerRef=s.a.createRef(),t.previousBodyStyle=void 0,t.announceMessage=function(e){t.elementAnnouncerRef.current.announceElement(e)},t.updateBody=function(){var e;G.b&&(window.screen.width<=500&&t.props.isOpen?(t.previousBodyStyle=null!=(e=document.body.getAttribute("style"))?e:null,document.body.style.setProperty("visibility","hidden","important"),document.body.style.setProperty("position","fixed","important")):void 0!==t.previousBodyStyle&&(null===t.previousBodyStyle?document.body.removeAttribute("style"):document.body.setAttribute("style",t.previousBodyStyle),t.previousBodyStyle=void 0))},t.onVisualViewportResize=function(){t.updateFromVisualViewport()},t.updateFromVisualViewport=function(){var e=t.props.wacContainerElement,n=window.visualViewport;if(n)e.style.setProperty("--WatsonAssistantChat-viewport-height",n.height+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-width",n.width+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetTop",n.offsetTop+"px"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetLeft",n.offsetLeft+"px");else{var a="100vh";if(G.b)a="calc(100vh - "+Object(G.d)()+"px)";e.style.setProperty("--WatsonAssistantChat-viewport-height",a),e.style.setProperty("--WatsonAssistantChat-viewport-width","100vw"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetTop","0"),e.style.setProperty("--WatsonAssistantChat-viewport-offsetLeft","0")}},t.setModalPortalHostElement=function(e){t.state.modalPortalHostElement!==e&&t.setState({modalPortalHostElement:e})},t.onSendBotInput=function(e,n){var a=Object(D.b)(e,n);t.props.serviceManager.actions.send(a,{trackEventProps:{eventName:"Assistant Message Received from User",eventDescription:"Dialog event for user giving input to bot.",type:"text"}})},t.onSendAgentInput=function(e){var n=t.props.serviceManager,a=Object(D.b)(e,H.b);n.humanAgentService.sendMessageToAgent(a)},t.removeChatFromDom=function(){t.containerRef.current.removeEventListener("animationend",t.removeChatFromDom),t.setState({open:!1,closing:!1})},t.onReset=function(){t.props.serviceManager.actions.resetChat()},t.onToggleOpen=function(){return In(t,void 0,void 0,(function(){return Bn(this,(function(e){switch(e.label){case 0:return[4,this.props.serviceManager.actions.toggleOpen()];case 1:return e.sent(),this.doDefaultFocus(),[2]}}))}))},t.onClose=function(){return In(t,void 0,void 0,(function(){return Bn(this,(function(e){switch(e.label){case 0:return[4,this.props.serviceManager.actions.closeWindow()];case 1:return e.sent(),this.doDefaultFocus(),[2]}}))}))},t.onToggleAgentView=function(){t.props.setPanelOpen(!t.props.agentState.isPanelOpen),t.doDefaultFocus();var e={eventName:"Human Chat Toggled",eventDescription:"User toggled chat between bot and human agent.",direction:t.props.agentState.isPanelOpen?"To agent":"To bot"};t.props.serviceManager.actions.track(e),t.doDefaultFocus()},t.onToggleProcessView=function(e){var n=t.props.processState;if(e||n.isProcessPanelOpen){t.setState({processOpening:!n.isProcessPanelOpen,processClosing:n.isProcessPanelOpen}),e&&t.props.serviceManager.actions.setCurrentProcess(e),p()((function(){n.isProcessPanelOpen?t.props.serviceManager.actions.closeProcess():t.props.serviceManager.actions.openProcess(e),t.setState({processOpening:!1,processClosing:!1})}),500),t.doDefaultFocus();var a={eventName:"Process Toggled",eventDescription:"User toggled between main chat and a process.",direction:t.props.processState.isProcessPanelOpen?"To process":"To main chat"};t.props.serviceManager.actions.track(a),t.doDefaultFocus()}},t.onClick=function(e){t.props.quickEscapeState.isOpen&&(t.isInQuickEscapeExclude(e.target)||t.props.serviceManager.store.dispatch(Ce.A.setQuickEscapeOpen(!1)))},t.onKeyDown=function(e){t.props.quickEscapeState.isOpen&&(Dn.has(e.key)||t.isInQuickEscapeExclude(e.target)||t.props.serviceManager.store.dispatch(Ce.A.setQuickEscapeOpen(!1)))},t}return Mn(t,e),t.prototype.componentDidMount=function(){if(G.c&&!this.props.config.public.disableCustomElementMobileEnhancements){var e=window.visualViewport;e&&(e.addEventListener("resize",this.onVisualViewportResize),e.addEventListener("scroll",this.updateFromVisualViewport)),this.updateFromVisualViewport(),this.updateBody()}},t.prototype.componentWillUnmount=function(){if(G.c&&!this.props.config.public.disableCustomElementMobileEnhancements){var e=window.visualViewport;e&&(e.removeEventListener("resize",this.onVisualViewportResize),e.removeEventListener("scroll",this.updateFromVisualViewport))}},t.prototype.componentDidUpdate=function(e,t){var n=this.props,a=n.isOpen,r=n.useCustomHostElement,o=this.state.open;a!==e.isOpen&&(this.updateBody(),this.updateFromVisualViewport()),!a||e.isOpen&&o?!a&&e.isOpen&&t.open&&o&&(this.setState({closing:!0}),r?this.removeChatFromDom():this.containerRef.current.addEventListener("animationend",this.removeChatFromDom)):this.setState({open:!0,openedOnce:!0})},t.prototype.isInQuickEscapeExclude=function(e){return Object(Ee.f)(e,"data-wac-quick-escape-exclude","true",this.containerRef.current)},t.prototype.doDefaultFocus=function(){this.props.isOpen?this.props.agentState.isPanelOpen?this.agentChatRef.current&&this.agentChatRef.current.requestInputFocus():this.botChatRef.current&&this.botChatRef.current.requestInputFocus():this.launcherRef.current&&this.launcherRef.current.requestFocus()},t.prototype.doAutoScroll=function(){var e;(e=this.props.agentState.isPanelOpen?this.agentChatRef.current:this.processChatRef.current?this.processChatRef.current:this.botChatRef.current)&&e.doAutoScroll()},t.prototype.renderChat=function(){var e=this.props,t=e.serviceManager,n=e.config,a=e.botName,r=e.botAvatarURL,i=e.languagePack,c=e.uuid,l=e.botMessageState,u=e.agentState,p=e.quickEscapeState,d=e.processState,m=e.isHydrated,g=e.allMessagesByID,f=e.showWelcomeError,h=e.sentMessagePercentage,_=u.isPanelOpen,C=n.public.__ibm__.isPreviewLink,v=n.public,E=v&&v.hideCloseButton||C,A=_||!this.state.processClosing&&d.isProcessPanelOpen,y=t.featureSet[R.a.QUICK_ESCAPE];return s.a.createElement(o.Fragment,null,s.a.createElement("div",{className:N()("WACBotContainer",{WAC__hidden:A})},s.a.createElement(Cn,{botName:a,botAvatarURL:r,ref:this.botChatRef,languagePack:i,config:n,serviceManager:t,isPreviewLink:C,uuid:c,hideCloseButton:E,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!1,isProcess:!1,threadID:O.b,messageState:l,onSendInput:this.onSendBotInput,agentState:u,processState:d,isVisible:!_,isHydrated:m,allMessagesByID:g,showWelcomeError:f,sentMessagePercentage:h,onReset:this.onReset,showQuickEscapeButton:p.showButton&&y})),d.currentViewedProcessId&&s.a.createElement("div",{className:N()("WACProcessContainer",{"WACProcessContainer--open":d.isProcessPanelOpen,"WACProcessContainer--opening":this.state.processOpening,"WACProcessContainer--closing":this.state.processClosing,"WACProcessContainer--closed":!d.isProcessPanelOpen&&!this.state.processOpening})},s.a.createElement(Cn,{botName:a,botAvatarURL:r,ref:this.processChatRef,languagePack:i,config:n,serviceManager:t,isPreviewLink:C,uuid:c,hideCloseButton:!0,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!1,isProcess:!0,threadID:d.currentViewedProcessId,messageState:d.processesByID[d.currentViewedProcessId],onSendInput:this.onSendBotInput,agentState:u,processState:d,isVisible:d.isProcessPanelOpen,isHydrated:!0,allMessagesByID:g,showWelcomeError:f,sentMessagePercentage:h,onReset:this.onReset})),s.a.createElement("div",{className:N()("WACAgentContainer",{WAC__hidden:!_,"WACAgentContainer--open":_,"WACAgentContainer--closed":!_})},s.a.createElement(Cn,{botName:a,botAvatarURL:r,ref:this.agentChatRef,languagePack:i,config:n,serviceManager:t,isPreviewLink:C,uuid:c,hideCloseButton:E,onClose:this.onClose,onToggleAgentView:this.onToggleAgentView,onToggleProcessView:this.onToggleProcessView,withHumanAgent:!0,isProcess:!1,threadID:H.b,messageState:u.agentMessageState,onSendInput:this.onSendAgentInput,agentState:u,processState:d,isVisible:_,isHydrated:!0,allMessagesByID:g,showWelcomeError:null,sentMessagePercentage:h,onReset:this.onReset})))},t.prototype.renderWithContexts=function(){var e=this.props,t=e.serviceManager,n=e.config,a=e.useCustomHostElement,r=e.languagePack,o=e.uuid,i=e.agentState,c=e.announceMessage,l=this.state,u=l.closing,p=l.open,d=l.openedOnce,m=n.public;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{id:"WACWidget",className:N()("WACWidget",{"WACWidget--defaultElement":!a,"WACWidget--launched":!u,"WACWidget--closing":u,"WACWidget--closed":!p}),"aria-label":r.window_title,ref:this.containerRef,onClick:this.onClick,onKeyDown:this.onKeyDown},s.a.createElement("div",{className:"WACWidget__animationContainer"},d&&this.renderChat()),s.a.createElement("div",{className:"WACWidget__modalPortalHost",ref:this.setModalPortalHostElement})),m&&m.showLauncher&&s.a.createElement(kn,{serviceManager:t,ref:this.launcherRef,uuid:o,languagePack:r,isOpen:this.props.isOpen,onToggleOpen:this.onToggleOpen,unreadAgentCount:i.numUnreadMessages}),s.a.createElement(Wn,{announcement:c}),s.a.createElement(bn,{ref:this.elementAnnouncerRef}))},t.prototype.render=function(){var e=this.props,t=e.languagePack,n=e.shadowRoot,a=e.locale,r=this.state.modalPortalHostElement;return s.a.createElement(P.IntlProvider,{locale:a,messages:t},s.a.createElement(Nn.Provider,{value:t},s.a.createElement(un.a.Provider,{value:n},s.a.createElement(U.Provider,{value:r},s.a.createElement($e.Provider,{value:this.announceMessage},s.a.createElement(w.a,null,this.renderWithContexts()))))),s.a.createElement(Kt.a,{id:"a11y-status-message",role:"status","aria-live":"polite","aria-relevant":"additions text"}))},t}(o.Component),xn=Object(l.connect)((function(e){return e}),{setPanelOpen:wn.r},null,{forwardRef:!0})(Ln),Hn=n(210);a.setLogger(null);var Fn=Object(r.createInstance)({sdkKey:"TnEXCTtScEApuT1VpPvHEq"});function jn(e,t,n,a,o,i,u){var p=e.store.getState(),d=p.userID,m=p.sessionID,g=p.config,f=g.public.__ibm__.isPreviewLink,h=g.remote.initConfig.service_instance_id||g.public.serviceInstanceID||Hn.a,_=Object(Rn.a)(h,d,m);c.a.render(s.a.createElement(l.Provider,{store:e.store},s.a.createElement(he.Provider,{value:e},s.a.createElement(r.OptimizelyProvider,{optimizely:Fn,user:{id:_,attributes:{isPreviewLink:f}}},s.a.createElement(On.Provider,{value:{optimizely:Fn,trackUserID:_,isServerSide:!1,isPreviewLink:f}},s.a.createElement(xn,{ref:u,useCustomHostElement:t,shadowRoot:o,uuid:i,serviceManager:e,wacContainerElement:a}))))),n)}Object(Me.a)(jn);t.default=jn}}]);